

package project;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.Scanner;

public class Student implements User {
    public String email;
    public String password;
    public UserType type;

    private boolean loggedIn;
    private PaymentManager balance;
    SystemDirectory directory;

    protected Student(String email, String password, UserType type) {
        this.email = email;
        this.password = password;
        this.type = type;

        directory = new SystemDirectory();
        balance = new PaymentManager();
    }

    // Methods from the interface
    public void login(String email, String password) {
        if (loggedIn) {
            System.out.println("You are already logged in.");
            UserManager.validateUser(this);
            return;
        } else if (this.email.equals(email) && this.password.equals(password)) {
            System.out.println("You are now logged in.");
            loggedIn = true;
        } else if (!this.email.equals(email) && !this.password.equals(password)) {
            System.out.println("Your email and password were incorrect");
        } else if (!this.email.equals(email)) {
            System.out.println("Your email was invalid");
        } else {
            System.out.println("Your password was incorrect");
        }
    }

    public void logout() {
        System.out.println("You are now logged out.");
        loggedIn = false;
    }

    public void rentItem(PhysicalItem physical) {
        BorrowPhysical.borrowItem(directory, physical, this);
    }

    public void viewBorrowedItems() {
        ArrayList<PhysicalItem> rentedItems = directory.getPhysicalRented();
        if (rentedItems.isEmpty()) {
            System.out.println("You haven't borrowed any items.");
        } else {
            System.out.println("List of borrowed items:");
            for (PhysicalItem item : rentedItems) {
                System.out.println("Title: " + item.getTitle());
                System.out.println("Location: " + item.getLocation());
                System.out.println("Rent Date: " + item.getRentDate());
                System.out.println("Due Date: " + item.getDueDate());
                System.out.println("------------------------------------");
            }
        }
    }

    public void returnItem(PhysicalItem physical) {
        BorrowPhysical.returnItem(directory, physical, this);
    }

    public void purchaseItem(PhysicalItem physical) {
       
            PurchasePhysical.purchase(physical, this);
        
    }

    public PaymentManager getBalance() {
        return balance;
    }

    public void subscribeToNewsLetter() {
        if (loggedIn) {
            Scanner scanner = new Scanner(System.in);
            System.out.println("Enter your email to subscribe to the newsletter:");
            String userEmail = scanner.nextLine();
            scanner.close();
            Subscription subscription = new Subscription(userEmail);
            subscription.subscribe();
            System.out.println("Subscription request sent successfully!");
        } else {
            System.out.println("You must be logged in to subscribe to the newsletter.");
        }
    }

    public void unsubscribeFromNewsletter() {
        if (loggedIn) {
            Scanner scanner = new Scanner(System.in);
            System.out.println("Enter your email to subscribe to the newsletter:");
            String userEmail = scanner.nextLine();
            scanner.close();
            Subscription subscription = new Subscription(userEmail);
            subscription.unsubscribe();
            if (subscription.isSubscribed()) {
                subscription.accessNewYorkTimes();
            }
            System.out.println("Unsubscription request sent successfully");
        } else {
            System.out.println("You must be logged in to unsubscribe to the newsletter.");
        }
    }

    // Additional methods specific to the StudentT class

    Map<String, String> courseInfo = new HashMap<String, String>();

    OnlineBook courseTextbook;

    public void addCourse(String courseName, String textbookName) {
        courseInfo.put(courseName, textbookName);
        if (textbookName != null) {
            courseTextbook = new OnlineBook(textbookName);
        }
    }

    public boolean checkCourse(String target) {
        return courseInfo.containsKey(target);
    }

    public boolean checkIfCourseTextbook(String target) {
        return checkCourse(target) && (courseInfo.get(target) != null);
    }

    public void setCourseDeadline(String courseName, LocalDate courseEndDate) {
        if (checkCourse(courseName) && checkIfCourseTextbook(courseName)) {
            courseTextbook.setCourseEndDate(courseEndDate);
            System.out.println("Changed the course deadline.");
        } else if (checkCourse(courseName) && !checkIfCourseTextbook(courseName)) {
            System.out.println("This course has not added a textbook yet.");
        } else {
            System.out.println("This course is not listed.");
        }
    }

    public void getCourseDeadline(String courseName) {
        if (checkCourse(courseName) && checkIfCourseTextbook(courseName)) {
            System.out.println(courseTextbook.getCourseEndDate());
        } else if (checkCourse(courseName) && !checkIfCourseTextbook(courseName)) {
            System.out.println("This course has not added a textbook yet.");
        } else {
            System.out.println("This course is not listed.");
        }
    }
}